2ï¸âƒ£ Atualizar o sistema (obrigatÃ³rio)
sudo apt update -y
sudo apt upgrade -y
sudo reboot


Reconecte apÃ³s o reboot.

3ï¸âƒ£ Instalar dependÃªncias bÃ¡sicas
sudo apt install -y curl git build-essential


Essas trÃªs evitam 80% dos erros depois.

4ï¸âƒ£ Instalar Node.js LTS (igual ao que funcionou)

Usamos Node 20, confirmado funcionando no seu projeto.

curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs


Verificar:

node -v
npm -v


Esperado:

v20.x.x

5ï¸âƒ£ Instalar PM2 (gerenciador de produÃ§Ã£o)
sudo npm install -g pm2


Verificar:

pm2 -v

6ï¸âƒ£ Criar estrutura do projeto (padrÃ£o que deu certo)
mkdir -p ~/Downloads/Minha_Barbearia-main/Barbearia
cd ~/Downloads/Minha_Barbearia-main/Barbearia


Estrutura final correta:

Barbearia/
â”œâ”€â”€ apis/
â”‚   â””â”€â”€ api.js
â”œâ”€â”€ Interfaceusuarios/

7ï¸âƒ£ Entrar na pasta do backend
cd apis


Confirmar:

ls


Tem que aparecer:

api.js

8ï¸âƒ£ Inicializar projeto Node (se nÃ£o existir)
npm init -y

9ï¸âƒ£ Instalar dependÃªncias (PASSO CRÃTICO)

Esse foi o erro que causou o problema antes.
Aqui estÃ¡ o comando exato que resolveu:

npm install express bcrypt jsonwebtoken sqlite3 multer archiver cors dotenv axios node-cron form-data


Isso cria:

node_modules/
package-lock.json

ğŸ”Ÿ Criar arquivo .env (exemplo funcional)
nano .env


Exemplo:

PORT=40003
JWT_SECRET=chave_super_secreta
WEBHOOK_API_URL=https://apiszap.appguardiaomais.com.br


Salvar.

1ï¸âƒ£1ï¸âƒ£ Testar o sistema SEM PM2 (obrigatÃ³rio)
node api.js


Resultado esperado (igual ao seu):

ğŸš€ Servidor rodando na porta 40003
âœ… Conectado ao banco SQLite
âœ… Tabelas verificadas/criadas com sucesso


Parar com:

CTRL + C

1ï¸âƒ£2ï¸âƒ£ Subir em PRODUÃ‡ÃƒO com PM2
pm2 start api.js --name barbearia-api
pm2 save


Verificar:

pm2 list


Esperado:

barbearia-api   online

1ï¸âƒ£3ï¸âƒ£ Ativar inicializaÃ§Ã£o automÃ¡tica (essencial)
pm2 startup systemd


O PM2 vai mostrar um comando sudo ....
ğŸ‘‰ Copie e execute exatamente como aparecer.

Depois:

pm2 save

1ï¸âƒ£4ï¸âƒ£ Teste final

Na VPS:

curl http://localhost:40003


Se responder, estÃ¡ pronto.

ğŸ§  RESUMO HONESTO

O que realmente importou para funcionar:

Node 20 (LTS)

npm install na pasta correta (apis)

.env presente

Testar com node api.js antes do PM2

PM2 sÃ³ depois que o Node rodar limpo
